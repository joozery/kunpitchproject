<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêõ Debug Upload FormData Issue</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
        }
        .debug-section {
            margin: 20px 0;
            padding: 20px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        .btn {
            background: #3b82f6;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        .btn:hover { background: #2563eb; }
        .btn-danger { background: #ef4444; }
        .btn-danger:hover { background: #dc2626; }
        .btn-success { background: #10b981; }
        .btn-success:hover { background: #059669; }
        .log-section {
            margin-top: 20px;
            padding: 20px;
            background: #1f2937;
            color: #f9fafb;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px 0;
            border-bottom: 1px solid #374151;
        }
        .log-success { color: #10b981; }
        .log-error { color: #ef4444; }
        .log-info { color: #3b82f6; }
        .log-warning { color: #f59e0b; }
        .file-info {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
        .form-data-debug {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üêõ Debug Upload FormData Issue</h1>
            <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á FormData ‡πÑ‡∏õ‡∏¢‡∏±‡∏á backend</p>
        </div>

        <div class="debug-section">
            <h3>üìÅ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h3>
            <input type="file" id="test-file" accept="image/*" />
            <div id="file-info" class="file-info" style="display: none;"></div>
        </div>

        <div class="debug-section">
            <h3>üß™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î</h3>
            <button class="btn" onclick="testFormDataCreation()">üìã ‡∏™‡∏£‡πâ‡∏≤‡∏á FormData</button>
            <button class="btn btn-success" onclick="testUpload()">üì§ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î</button>
            <button class="btn btn-danger" onclick="testRawFetch()">üîß ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Raw Fetch</button>
            <button class="btn" onclick="clearLog()">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á Log</button>
        </div>

        <div class="debug-section">
            <h3>üîç Debug Information</h3>
            <div id="debug-info"></div>
        </div>

        <div class="log-section">
            <h3>üìã Log ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</h3>
            <div id="log-content"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://backendkunpitch-app-43efa3b2a3ab.herokuapp.com';
        let selectedFile = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setupFileInput();
        });

        function setupFileInput() {
            const fileInput = document.getElementById('test-file');
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    selectedFile = e.target.files[0];
                    displayFileInfo(selectedFile);
                    log(`üìÅ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå: ${selectedFile.name}`, 'info');
                }
            });
        }

        function displayFileInfo(file) {
            const fileInfo = document.getElementById('file-info');
            fileInfo.style.display = 'block';
            fileInfo.innerHTML = `
                <h4>üìÅ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ü‡∏•‡πå</h4>
                <p><strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> ${file.name}</p>
                <p><strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</strong> ${file.type}</p>
                <p><strong>‡∏Ç‡∏ô‡∏≤‡∏î:</strong> ${(file.size / 1024 / 1024).toFixed(2)} MB</p>
                <p><strong>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:</strong> ${new Date(file.lastModified).toLocaleString('th-TH')}</p>
            `;
        }

        function testFormDataCreation() {
            if (!selectedFile) {
                log('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô', 'error');
                return;
            }

            log('üß™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á FormData', 'info');
            
            const formData = new FormData();
            formData.append('image', selectedFile);
            
            // Debug FormData contents
            log('üìã FormData contents:', 'info');
            for (let [key, value] of formData.entries()) {
                log(`  ${key}: ${value.name} (${value.type}, ${(value.size / 1024 / 1024).toFixed(2)}MB)`, 'info');
            }
            
            // Test FormData methods
            log(`üìä FormData size: ${formData.getAll('image').length} entries`, 'info');
            log(`üìä FormData has 'image': ${formData.has('image')}`, 'info');
            
            // Store for later use
            window.testFormData = formData;
            
            log('‚úÖ FormData ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        }

        async function testUpload() {
            if (!selectedFile) {
                log('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô', 'error');
                return;
            }

            if (!window.testFormData) {
                log('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á FormData ‡∏Å‡πà‡∏≠‡∏ô', 'error');
                return;
            }

            log('üì§ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î...', 'info');
            
            try {
                // Test with our FormData
                const response = await fetch(`${API_BASE}/api/upload/single`, {
                    method: 'POST',
                    body: window.testFormData
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    log(`‚úÖ ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${result.message}`, 'success');
                    log(`üìä URL: ${result.data.url}`, 'info');
                } else {
                    log(`‚ùå ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${result.message}`, 'error');
                    if (result.details) {
                        log(`üìù ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: ${result.details}`, 'error');
                    }
                }
                
                log(`üìä Response Status: ${response.status}`, 'info');
                log(`üìä Response Headers:`, 'info');
                for (let [key, value] of response.headers.entries()) {
                    log(`  ${key}: ${value}`, 'info');
                }
                
            } catch (error) {
                log(`‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function testRawFetch() {
            if (!selectedFile) {
                log('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô', 'error');
                return;
            }

            log('üîß ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Raw Fetch...', 'info');
            
            try {
                // Create new FormData for this test
                const formData = new FormData();
                formData.append('image', selectedFile);
                
                // Log what we're sending
                log('üì§ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:', 'info');
                log(`  Method: POST`, 'info');
                log(`  URL: ${API_BASE}/api/upload/single`, 'info');
                log(`  Body: FormData with ${formData.getAll('image').length} files`, 'info');
                
                // Test upload
                const response = await fetch(`${API_BASE}/api/upload/single`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                log(`üìä Response Status: ${response.status}`, 'info');
                log(`üìä Response Body: ${JSON.stringify(result, null, 2)}`, 'info');
                
                if (response.ok) {
                    log('‚úÖ Raw Fetch ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                } else {
                    log('‚ùå Raw Fetch ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', 'error');
                }
                
            } catch (error) {
                log(`‚ùå Raw Fetch Error: ${error.message}`, 'error');
            }
        }

        function clearLog() {
            document.getElementById('log-content').innerHTML = '';
            log('üóëÔ∏è Log ‡∏ñ‡∏π‡∏Å‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß', 'info');
        }

        function log(message, type = 'info') {
            const logContent = document.getElementById('log-content');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = `[${new Date().toLocaleTimeString('th-TH')}] ${message}`;
            
            logContent.appendChild(logEntry);
            logContent.scrollTop = logContent.scrollHeight;
        }

        // Test API endpoints
        async function testAPIEndpoints() {
            log('üß™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö API Endpoints', 'info');
            
            try {
                // Test health
                const healthResponse = await fetch(`${API_BASE}/api/health`);
                log(`üåê Health: ${healthResponse.status} ${healthResponse.statusText}`, healthResponse.ok ? 'success' : 'error');
                
                // Test upload test
                const uploadTestResponse = await fetch(`${API_BASE}/api/upload/test`);
                log(`üì§ Upload Test: ${uploadTestResponse.status} ${uploadTestResponse.statusText}`, uploadTestResponse.ok ? 'success' : 'error');
                
            } catch (error) {
                log(`‚ùå API Test Error: ${error.message}`, 'error');
            }
        }

        // Auto-test on load
        setTimeout(testAPIEndpoints, 1000);
    </script>
</body>
</html> 